# comrademajor
Телеграм-бот для юридической экспертизы текста


Этот проект — Телеграм-бот, выступающий в роли юридического советника, предназначенного для ускорения процесса лингвистической экспертизы текстов. Бот анализирует сообщения пользователей на соответствие юридическим статьям, формирует отчёты и предоставляет рекомендации. Используется библиотека aiogram для интеграции с Telegram и g4f для взаимодействия с ИИ-моделями.

Возможности





Юридический анализ текста: Проверяет текст пользователя на соответствие заданным юридическим статьям.



Очередь запросов: Обрабатывает запросы последовательно, предотвращая перегрузку.



Индикатор прогресса: Отображает прогресс-бар во время анализа.



Формирование отчёта: Создаёт подробный отчёт и отправляет его в виде документа.



Интерактивные кнопки: Предлагает действия после анализа: оплата штрафа, получение бланка самодоноса, звонок другу или подтверждение статуса.



Обработка ошибок: Корректно обрабатывает ошибки файлов, провайдеров и таймауты.

Требования





Python 3.8+



Библиотеки:





aiogram==3.20.0.post0



g4f==0.5.5.5



Стандартные библиотеки Python: json, uuid, os, random, time, logging, collections, typing, asyncio

Установка зависимостей:

pip install -r requirements.txt

Содержимое requirements.txt:

aiogram==3.20.0.post0
g4f==0.5.5.5

Установка





Токен бота:





Замените BOT_TOKEN в коде на токен вашего бота, полученный через BotFather.



Структура файлов:





Создайте директорию проекта со следующими файлами:





prompt.txt: Шаблон для запросов к ИИ с заполнителями {article_content} и {user_input}.



prompt2.txt: Шаблон для обработки отчёта с заполнителем {report_content}.



denials.txt: Список фраз для фильтрации некорректных ответов ИИ (по одной на строку).



articles.json: JSON-файл с номерами юридических статей и их содержимым.



qrcode.png: QR-код для оплаты штрафа (опционально).



blank.doc: Бланк самодоноса (опционально).



Настройка директории:





Убедитесь, что все файлы находятся в той же директории, что и скрипт, доступной через os.path.dirname(os.path.abspath(__file__)).



Конфигурация:





Список ARTICLES определяет номера статей для анализа.



PROVIDER_MODELS сопоставляет провайдеров ИИ (OpenaiChat, Bing, Chatgpt4o, Perplexity) с их моделями.



Порог срабатывания анализа текста (по умолчанию 50 символов) можно изменить в коде в функции text_handler.

Использование





Запуск бота:

python bot.py

Бот начинает опрос и ожидает команды и сообщения.



Команды:





/start: Отправляет приветственное сообщение.



/analyze <текст>: Анализирует указанный текст и формирует юридический отчёт.



Любое текстовое сообщение длиннее 50 символов автоматически анализируется (порог можно изменить в коде).



Действия после анализа: После анализа пользователь получает отчёт и клавиатуру с опциями:





Оплатить штраф: Отправляет QR-код для оплаты (qrcode.png).



Получить бланк: Отправляет бланк самодоноса (blank.doc).



Позвонить другу: Сообщает, что звонок недоступен.



Брянск-Север: Подтверждает статус (заглушка).

Как работает





Назначение: Бот ускоряет юридическую экспертизу, анализируя текст на соответствие статьям, предоставляя быстрые рекомендации и отчёты.



Система очереди: Пользователи добавляются в очередь (user_queue) для последовательной обработки, избегая наложений (user_busy).



Анализ текста:





Читает шаблон из prompt.txt и статьи из articles.json.



Отправляет текст и содержимое статей в ИИ-модели через g4f.



Фильтрует ответы с помощью denials.txt для исключения некорректных ответов.



Прогресс-бар: Обновляет пользователя о прогрессе анализа (0–100%).



Формирование отчёта:





Объединяет результаты анализа в отчёт, очищает от лишних тегов.



Обрабатывает отчёт с использованием prompt2.txt.



Сохраняет отчёт как report_<uuid>.txt и отправляет пользователю.



Ответы с привязкой: Все сообщения и документы отправляются с reply_to_message_id для привязки к исходному сообщению пользователя.



Обработка ошибок:





Повторяет запросы к провайдерам до 10 раз при сбоях.



Отслеживает сбои провайдеров с 10-минутным таймаутом.



Обрабатывает ошибки файлов и кодировки.

Описание файлов





prompt.txt: Шаблон для запросов к ИИ с заполнителями {article_content} и {user_input}.



prompt2.txt: Шаблон для обработки отчёта с заполнителем {report_content}.



denials.txt: Список фраз для фильтрации некорректных ответов (по одной на строку).



articles.json: JSON с номерами юридических статей и их содержимым.



qrcode.png: QR-код для оплаты штрафа (опционально).



blank.doc: Бланк самодоноса (опционально).

Примечания





Лимит символов: Текст ограничен 2000 символами.



Порог срабатывания: Анализ текста запускается для сообщений длиннее 50 символов (настраивается в text_handler).



Провайдеры ИИ: Бот перебирает провайдеров (OpenaiChat, Bing, Chatgpt4o, Perplexity) и их модели для надёжных ответов.



Проверка кириллицы: Ответы проверяются на наличие кириллических символов для фильтрации.



Логирование: Используется модуль logging для отладки и мониторинга.

Развёртывание

Для развёртывания бота:





Убедитесь, что все необходимые файлы на месте.



Настройте сервер или локальную среду с Python и зависимостями.



Запустите скрипт и поддерживайте его работу для постоянного опроса.



Для продакшена используйте менеджеры процессов, такие как pm2 или systemd.

Ограничения





Требуется стабильное интернет-соединение для запросов к провайдерам ИИ.



Пути к файлам относительны к директории скрипта.



Не поддерживаются файлы с кодировкой, отличной от UTF-8.



Функции QR-кода и бланка требуют наличия соответствующих файлов (qrcode.png, blank.doc).

Вклад в проект

Приглашаем форкать репозиторий, вносить улучшения и отправлять пул-реквесты. Убедитесь, что изменения совместимы с текущей структурой файлов и зависимостями.

Лицензия

Проект распространяется под лицензией MIT.
